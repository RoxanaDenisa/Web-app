$(document).ready(function(){
	moneda=" lei"
	
	function check_if_is_admin(){
		var val;
		jQuery.ajax({
		 type: "POST",
		 async: false,
		 url: 'php/get_admin_status.php',
		 /*dataType: 'text',*/
		 success: function (data, textStatus) {
		        if(data==1)
					val = true;
				else
					val = false;
		        }
		});
		console.log(val);
		return val;
	}
	
	//click on product	
	$(document).on( "click", "#product" ,function() {//la click pe meniul din stanga
		product=$(this).find('img').attr("value");//.text();
		container=$(".container");
		container.html("");
		//console.log(product);
	  //	
	  /*jQuery.ajax({
		 type: "POST",
		 url: 'php/get_products.php',
		 dataType: 'json',
		 data: {categorie : categorie},
		 success: function (data, textStatus) {
		            left_menu = $("#butoane");
					container = $(".container");
					container.html("");
					for(i=0; i < data.length;i++){
						images=get_files(data[i]['url_imagini']);
						if(images.length==0)
							images=["../noimage.jpg"];//imagine standard
						div=$('<div id="product">');
						div.append('<img id="x" value="'+data[i]['id']+'" src="image/x.png" style="width: 30px; position: absolute; margin-left: 169px;">');
						div.append('<img class="nimi_pres_img" src="'+data[i]['url_imagini']+"/"+images[0]+'">');
						div.append('<p id="descriere">'+data[i]['nume_produs']+'</p>');
						div.append('<p id="pret">'+data[i]['pret']+moneda+'</p>');
						container.append(div);
					}
		        }
		});*/
	});
	/*left menu click*/
	$(document).on( "click", "#buton" ,function() {//la click pe meniul din stanga
	  categorie=$(this).first().text();	
	  jQuery.ajax({
		 type: "POST",
		 url: 'php/get_products.php',
		 dataType: 'json',
		 data: {categorie : categorie},
		 success: function (data, textStatus) {
		            left_menu = $("#butoane");
					container = $(".container");
					container.html("");
					for(i=0; i < data.length;i++){
						images=get_files(data[i]['url_imagini']);
						if(images.length==0)
							images=["../noimage.jpg"];//imagine standard
						div=$('<div id="product">');
						if(check_if_is_admin()==true)
							div.append('<img id="x" value="'+data[i]['id']+'" src="image/x.png" style="width: 30px; position: absolute; margin-left: 169px;">');
						div.append('<img class="nimi_pres_img" src="'+data[i]['url_imagini']+"/"+images[0]+'">');
						div.append('<p id="descriere">'+data[i]['nume_produs']+'</p>');
						div.append('<p id="pret">'+data[i]['pret']+moneda+'</p>');
						container.append(div);
					}
		        }
		});
	});
	/*click pe x*/
	$(document).on( "click", "#x" ,function() {//event de stergere produs
	  product=$(this).parent();
	  id=$(this).attr("value");	
	  //console.log(id );

	  jQuery.ajax({
		 type: "POST",
		 url: 'php/delete_product.php',
		 dataType: 'text',
		 data: {id : id},
		 success: function (data, textStatus) {
		           
					product.remove();
					if(product.parent().length==0)
						location.reload();
					//foreach butoane
		        }
		});
	});
	
	function get_files(path){
		var r;
		path = "../" + path + "/*";	
		jQuery.ajax({
		 type: "POST",
		 async: false,
		 url: "php/get_files.php",
		 data: { dir : path },
		 dataType: 'json',
		 success: function(data) {
		 	r = data;
		  }
		});
		return r;
	}
	
	function not_in(a,b){
		for(j=0;j<categorii_inserate.length;j++)
			if(a==b[j])
				return false;
		return true;
	}

	function generate_categories(){
		jQuery.ajax({
		 type: "POST",
		 data: {categorie : "%"},
		 url: 'php/get_products.php',
		 dataType: 'json',
		 success: function (data, textStatus) {
					categorii_inserate=[];
		            left_menu = $("#butoane");
					//console.log(left_menu);
		            for(i=0; i < data.length;i++){
							if(not_in(data[i]["categorie"], categorii_inserate)){
								left_menu.append('<div id="buton"><a href="#">'+data[i]["categorie"]+'</a></div>');
								categorii_inserate.push(data[i]["categorie"]);
							}
						//console.log(categorii_inserate);
			        }
					
		        }
		});
	}

	function load_all_products(){
		
	 	jQuery.ajax({
		 type: "POST",
		 url: 'php/get_products.php',
		 dataType: 'json',
		 data: {categorie : "%"},
		 success: function ( data , textStatus) {
			 //console.log(data);
				container = $(".container");
				for(i=0; i < data.length;i++){
					images=get_files(data[i]['url_imagini']);
					if(images.length==0)
						images=["../noimage.jpg"];//imagine standard
					div=$('<div id="product">');
					if(check_if_is_admin()==true)
						div.append('<img id="x" value="	'+data[i]['id']+'"src="image/x.png" style="width: 30px; position: absolute; margin-left: 169px;">');
					div.append('<img class="nimi_pres_img" src="'+data[i]['url_imagini']+"/"+images[0]+'">');
					div.append('<p id="descriere">'+data[i]['nume_produs']+'</p>');
					div.append('<p id="pret">'+data[i]['pret']+moneda+'</p>');
					container.append(div);
				}
			}
		});
	}

	load_all_products();
	generate_categories();
	//console.log(check_if_is_admin());
});